version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "4301:8000" # Expose FastAPI port 4301 externally, map to FastAPI's internal port 8000
      - "4302:8001" # Expose FastMCP port 4302 externally, map to FastMCP's internal port 8001
    # Add environment variables if needed for the backend, e.g., database connection
    environment:
      # Example: DATABASE_URL=postgresql://user:password@db:5432/mydatabase
      # Make sure to update your FastAPI app to read these environment variables
      PYTHONUNBUFFERED: 1
      ALLOWED_ORIGINS: http://localhost:4300
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "8001"
    # For development, you might want to mount volumes for live code changes:
    # volumes:
    #   - ./backend:/app

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        API_URL: http://localhost:4301 # This points to the backend service within the Docker network
    ports:
      - "4300:80" # Expose frontend HTTP port 4300 externally
    depends_on:
      - backend
    # For development, you might want to mount volumes for live code changes:
    # volumes:
    #   - ./frontend:/app
